<?xml version="1.0" encoding="UTF-8"?>
<odoo>
  <record id="view_course_list" model="ir.ui.view">
    <field name="name">student.course.list</field>
    <field name="model">student.course</field>
    <field name="arch" type="xml">
      <list>
        <field name="name"/>
        <field name="code"/>
        <field name="credit"/>
      </list>
    </field>
  </record>

  <record id="view_course_form" model="ir.ui.view">
    <field name="name">student.course.form</field>
    <field name="model">student.course</field>
    <field name="arch" type="xml">
      <form string="Course">
        <header>
          <button name="action_view_students" type="object" string="View Students"/>
          <button name="action_print_student_list" type="object" string="Print Student List" class="oe_highlight"/>
        </header>
        <sheet>
          <group>
            <group>
              <field name="name"/>
              <field name="code"/>
              <field name="credit"/>
            </group>
            <group>
              <field name="student_ids" widget="many2many_tags" readonly="1"/>
            </group>
          </group>
          <notebook>
            <page string="Students">
              <field name="student_ids" readonly="1">
                <list>
                  <field name="name"/>
                  <field name="email"/>
                  <field name="roll_no"/>
                  <field name="department"/>
                </list>
              </field>
            </page>
          </notebook>
        </sheet>
      </form>
    </field>
  </record>

  <!-- Report template + action (PDF) -->
  <template id="course_student_report_tmpl">
    <t t-call="web.html_container">
      <t t-foreach="docs" t-as="course">
        <div class="page">
          <h2>Students enrolled in <t t-esc="course.name"/> (<t t-esc="course.code"/>)</h2>
          <p>Credit: <t t-esc="course.credit"/></p>
          <table class="table table-sm o_main_table">
            <thead>
              <tr><th>Name</th><th>Email</th><th>Roll No</th><th>Department</th></tr>
            </thead>
            <tbody>
              <t t-foreach="course.student_ids" t-as="st">
                <tr>
                  <td><t t-esc="st.name"/></td>
                  <td><t t-esc="st.email"/></td>
                  <td><t t-esc="st.roll_no"/></td>
                  <td><t t-esc="st.department"/></td>
                </tr>
              </t>
              <t t-if="not course.student_ids">
                <tr><td colspan="4">No students enrolled.</td></tr>
              </t>
            </tbody>
          </table>
        </div>
      </t>
    </t>
  </template>

  <record id="course_student_report_action" model="ir.actions.report">
    <field name="name">Course Student List</field>
    <field name="model">student.course</field>
    <field name="report_type">qweb-pdf</field>
    <field name="report_name">student_management.course_student_report_tmpl</field>
    <field name="print_report_name">'Students_in_%s' % (object.name)</field>
  </record>
</odoo>
